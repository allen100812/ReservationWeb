@page
@model Web0524.Pages.OrdersetEditModel
@{
}
<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="~/css/Share.css">
    <link rel="stylesheet" href="~/css/wickedcss.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .card-custom {
            background-color: #d3d3d3; /* 设置自定义的背景颜色 */
        }
    </style>
    <style>
        .form-group label {
            color: var(--color3_2);
        }

        .infotext {
            font-size: 14px;
            color: var(--color3_2);
        }

    </style>
</head>
<body>
    <div class="container page-basetop">
        <header>
            <div class="animation-div">
                <h2 class="header_text heading break-all slideInRight">
                    預約單內容
                </h2>
            </div>

        </header>

        <form method="post">
            <div class="form-group" style="display: none;">
                <input asp-for="Orderset.Pid" class="form-control" readonly />
                <span class="text-danger"></span>
            </div>
            <div class="form-group" style="display: none;">
                <input asp-for="Orderset.Pname" class="form-control" readonly />
                <span class="text-danger"></span>
            </div>
            <div class="form-group" style="display: none;">
                <input asp-for="Orderset.Price" class="form-control" readonly />
                <span class="text-danger"></span>
            </div>
            <div class="form-group" style="display: none;">
                <label>產品單位</label>
                <input asp-for="Orderset.Unit" class="form-control" readonly />
                <span class="text-danger"></span>
            </div>
            <div class="form-group" style="display: none;">
                <label asp-for="Orderset.Event"></label>
                <input asp-for="Orderset.Event" class="form-control" readonly />
            </div>
            <div class="form-group" style="display: none;">
                <label asp-for="Orderset.Uid"></label>
                <input asp-for="Orderset.Uid" class="form-control" readonly />
            </div>
            <div class="form-group" style="display: none;">
                <label asp-for="Orderset.Uname"></label>
                <input asp-for="Orderset.Uname" class="form-control" readonly />
            </div>

            <div class="card">
                <div class="card-body">
                    <div>
                        <h5 class="text-left zoomer">@("S" + Model.Orderset.Sid.ToString().PadLeft(6, '0'))</h5>
                        <p>
                            @{
                                switch (Model.Orderset.Event)
                                {
                                    case "0":
                                        <i class="fas fa-clock text-info icon-width"></i>
                                        <td><span class="text-info">正在等待接受</span></td>
                                        break;
                                    case "1":
                                        <i class="fas fa-check-circle text-success icon-width"></i>
                                        <td><span class="text-success">預約成功</span></td>
                                        break;
                                    case "9":
                                        <i class="fas fa-times-circle text-danger icon-width"></i>
                                        <td><span class="text-danger">預約已取消</span></td>
                                        break;
                                    case "10":
                                        <i class="fas fa-hourglass text-secondary icon-width"></i>
                                        <td><span class="text-secondary">未被接受</span></td>
                                        break;
                                    case "11":
                                        <i class="fas fa-check text-primary icon-width"></i>
                                        <td><span class="text-primary">已完成</span></td>
                                        break;
                                    case "19":
                                        <i class="fas fa-ban text-secondary icon-width"></i>
                                        <td><span class="text-secondary">已取消</span></td>
                                        break;
                                    default:
                                        <i class="fas fa-question-circle text-muted icon-width"></i>
                                        <td><span class="text-muted">不明</span></td>
                                        break;
                                }
                            }
                        </p>
                    </div>

                    @{
                        DateTime date = Convert.ToDateTime(Model.Orderset.Date);

                    }
                    <div class="form-group alert alert-light alert-form-div" role="alert">
                        <table>
                            <tr>
                                <th><i class="fas fa-stream icon-width"></i>項目:</th>
                                <td>@Model.Orderset.Pname</td>
                            </tr>
                            <tr>
                                <th><i class="fas fa-map-marker-alt icon-width"></i>地點:</th>
                                <td>@Model.place.Placetitle : @Model.place.Placeaddress</td>
                            </tr>
                            <tr>
                                <th><i class="fas fa-clock icon-width"></i>時間:</th>
                                @if (Model.Orderset.Time.HasValue)
                                {
                                    <td>@date.ToShortDateString() @Model.Orderset.Time.Value.ToString("hh\\:mm")</td>
                                }
                                else
                                {
                                    <td>@date.ToShortDateString()</td>
                                }
                            </tr>
                            <tr>
                                <th><i class="fas fa-dollar-sign icon-width"></i>價格:</th>
                                <td>
                                    @{
                                        string price = Model.Orderset.Price != null ? string.Format("{0:N0}", Model.Orderset.Price) : "無";
                                        string unit = Model.Orderset.Unit != null ? "/" + Model.Orderset.Unit.ToString() : "";
                                    }

                                    @price@unit
                                </td>
                            </tr>
                            <tr>
                                <th><i class="fas fa-user icon-width"></i>會員:</th>
                                <td>
                                    
                                    @if(Model.Orderset_user.LineUserId == null || Model.Orderset_user.LineUserId == "")
                                    {
                                        @Model.Orderset.Uname
                                        <span class="text-danger">(未綁定Line自動通知，需自行通知)</span>
                                        
                                    }else{
                                        @Model.Orderset.Uname
                                        <span>(已綁定Line自動通知)</span>
                                    }
                                    
                                </td>
                            </tr>
                            <tr>
                                @{
                                    var UserPoint = Model.UserPointTB.FirstOrDefault(up => up.uid.ToString() == Model.Orderset.Uid);
                                    string UserPointStr1 = "無評分";
                                    string UserPointStr2 = "無評分";
                                    foreach (Web0524.Models.UserPointStr userPointStr in Model.userPointStr)
                                    {
                                        if (UserPoint.point >= userPointStr.Rate_s && UserPoint.point < userPointStr.Rate_e)
                                        {
                                            UserPointStr1 = userPointStr.Str1;
                                            UserPointStr2 = userPointStr.Str2;
                                        }
                                    }

                                    <th><i class="fas fa-star icon-width"></i>評分</th>
                                    <td>
                                        @if (UserPoint.point > 0 && UserPoint.point <= 2)
                                        {
                                            string textColor = "black"; // 默认颜色

                                            // 根据评分级别设置文字颜色
                                            switch (UserPointStr1)
                                            {
                                                case "冠軍":
                                                    textColor = "#00FF00"; // 绿色
                                                    break;
                                                case "優質":
                                                    textColor = "#3399FF"; // 蓝色
                                                    break;
                                                case "普通":
                                                    textColor = "#FF9900"; // 橙色
                                                    break;
                                                case "不良":
                                                    textColor = "#FF0000"; // 红色
                                                    break;
                                                case "差勁":
                                                    textColor = "#990099"; // 紫色
                                                    break;
                                                case "惡意":
                                                    textColor = "#FF66CC"; // 粉红色
                                                    break;
                                            }

                                            <p style="color: @textColor;">@UserPointStr1 ( @UserPointStr2 )</p>
                                        }
                                        else
                                        {
                                            <p>尚無評分</p>
                                        }
                                    </td>
                                }
                            </tr>
                        </table>
                    </div>
                </div>
            </div>


            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">當日預約單</h5>
                    <div class="table-responsive">
                        <table class="table">
                            <tbody>


                                @foreach (var TodayOrder in Model.Orderset_CheckDate)
                                {
                                    switch (TodayOrder.Event)
                                    {
                                        case "0":
                                            <div class="alert alert-warning" role="alert">
                                                <i class="fas fa-clock icon-width"></i> @TodayOrder.Time @TodayOrder.Pname
                                                <a href="/OrdersetEdit?sid=@TodayOrder.Sid">查看</a>
                                            </div>
                                            break;
                                        case "1":
                                            <div class="alert alert-primary" role="alert">
                                                <i class="fas fa-clock icon-width"></i> @TodayOrder.Time @TodayOrder.Pname
                                                <a href="/OrdersetEdit?sid=@TodayOrder.Sid">查看</a>
                                            </div>
                                            break;
                                        case "9":
                                            <div class="alert alert-danger" role="alert">
                                                <i class="fas fa-clock icon-width"></i> @TodayOrder.Time @TodayOrder.Pname
                                                <a href="/OrdersetEdit?sid=@TodayOrder.Sid">查看</a>
                                            </div>
                                            break;
                                        default:
                                            <div class="alert alert-dark" role="alert">
                                                <i class="fas fa-clock icon-width"></i> @TodayOrder.Time @TodayOrder.Pname
                                                <a href="/OrdersetEdit?sid=@TodayOrder.Sid">查看</a>
                                            </div>
                                            break;
                                    }

                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <script>
                function confirmAndSubmit(type) {
                    var confirmed = false;
                    if (type === 1) {
                        confirmed = confirm('確認接受預約？');
                        eventInput.value = "1";
                    } else if (type === 2) {
                        confirmed = confirm('確認拒絕預約？');
                        eventInput.value = "9";
                    } else if (type === 10) {
                        confirmed = confirm('確認將本預約單轉換為未接受預約？');
                        eventInput.value = "10";
                    } else if (type === 11) {
                        confirmed = confirm('確認將本預約單轉換為已完成預約？');
                        eventInput.value = "11";
                    } else if (type === 19) {
                        confirmed = confirm('確認將本預約單轉換為已取消預約？');
                        eventInput.value = "19";
                    }
                    if (confirmed) {
                        document.querySelector('form').submit(); // 提交表單，將日期傳遞到後端
                    } else {
                        // 取消確認，不進行任何動作
                    }
                }
            </script>
            @if (Model.Orderset.Event == "0")
            {
                <form method="post">
                    <input type="hidden" name="Event" id="eventInput" value="" />
                    <div class="row">
                        <div class="col -12">
                            <input type="hidden" name="sid" value="@Model.Orderset.Sid" />
                            <button type="button" class="btn btn-success btn-block" onclick="confirmAndSubmit(1)"><i class="fas fa-check"></i>接受預約</button>
                        </div>
                        <div class="col -12">
                            <input type="hidden" name="sid" value="@Model.Orderset.Sid" />
                            <button type="button" class="btn btn-danger btn-block" onclick="confirmAndSubmit(2)"><i class="fas fa-times"></i>拒絕預約</button>
                        </div>
                        <div class="col -12">
                            <button id="contactButton" type="button" class="btn btn-primary btn-block"><i class="fas fa-phone"></i>聯繫顧客</button>
                        </div>
                    </div>
                </form>
            }
            else if (Model.Orderset.Event == "1")
            {
                <form method="post">
                    <input type="hidden" name="Event" id="eventInput" value="" />
                    <div class="row">
                        <div class="col -12">
                            <input type="hidden" name="sid" value="@Model.Orderset.Sid" />
                            <button type="button" class="btn btn-danger btn-block" onclick="confirmAndSubmit(2)"><i class="fas fa-times"></i>拒絕預約</button>
                        </div>

                        <div class="col -12">
                            <button id="contactButton" type="button" class="btn btn-primary btn-block"><i class="fas fa-phone"></i>聯繫顧客</button>
                        </div>
                    </div>
                </form>

            }
            else if (Model.Orderset.Event == "9")
            {
                <form method="post">
                    <input type="hidden" name="Event" id="eventInput" value="" />
                    <div class="row">
                        <div class="col -12">

                            <input type="hidden" name="sid" value="@Model.Orderset.Sid" />
                            <button type="button" class="btn btn-success btn-block" onclick="confirmAndSubmit(1)"><i class="fas fa-check"></i>接受預約</button>

                        </div>

                        <div class="col -12">
                            <button id="contactButton" type="button" class="btn btn-primary btn-block"><i class="fas fa-phone"></i>聯繫顧客</button>
                        </div>
                    </div>
                </form>
            }
            else if (Model.Orderset.Event == "10")
            {
                <form method="post">
                    <input type="hidden" name="Event" id="eventInput" value="" />
                    <div class="row">
                        <div class="col -12">
                            <input type="hidden" name="sid" value="@Model.Orderset.Sid" />
                            <button type="button" class="btn btn-success btn-block" onclick="confirmAndSubmit(11)"><i class="fas fa-calendar-check"></i>已完成預約</button>
                        </div>

                        <div class="col -12">
                            <input type="hidden" name="sid" value="@Model.Orderset.Sid" />
                            <button type="button" class="btn btn-danger btn-block" onclick="confirmAndSubmit(19)"><i class="fas fa-calendar-times"></i>已取消預約</button>
                        </div>
                        <div class="col -12">
                            <button id="contactButton" type="button" class="btn btn-primary btn-block"><i class="fas fa-phone"></i>聯繫顧客</button>
                        </div>
                    </div>
                </form>
            }
            else if (Model.Orderset.Event == "11")
            {
                <form method="post">
                    <input type="hidden" name="Event" id="eventInput" value="" />
                    <div class="row">
                        <div class="col -12">
                            <input type="hidden" name="sid" value="@Model.Orderset.Sid" />
                            <button type="button" class="btn btn-warning btn-block" onclick="confirmAndSubmit(10)"><i class="fas fa-calendar-minus"></i>未接受預約</button>
                        </div>

                        <div class="col -12">
                            <input type="hidden" name="sid" value="@Model.Orderset.Sid" />
                            <button type="button" class="btn btn-danger btn-block" onclick="confirmAndSubmit(19)"><i class="fas fa-calendar-times"></i>已取消預約</button>
                        </div>

                        <div class="col -12">
                            <button id="contactButton" type="button" class="btn btn-primary btn-block"><i class="fas fa-phone"></i>聯繫顧客</button>
                        </div>
                    </div>
                </form>
            }
            else if (Model.Orderset.Event == "19")
            {
                <form method="post">
                    <input type="hidden" name="Event" id="eventInput" value="" />
                    <div class="row">
                        <div class="col -12">
                            <input type="hidden" name="sid" value="@Model.Orderset.Sid" />
                            <button type="button" class="btn btn-success btn-block" onclick="confirmAndSubmit(11)"><i class="fas fa-calendar-check"></i>已完成預約</button>
                        </div>

                        <div class="col -12">
                            <input type="hidden" name="sid" value="@Model.Orderset.Sid" />
                            <button type="button" class="btn btn-warning btn-block" onclick="confirmAndSubmit(10)"><i class="fas fa-calendar-minus"></i>未接受預約</button>
                        </div>
                        <div class="col -12">
                            <button id="contactButton" type="button" class="btn btn-primary btn-block"><i class="fas fa-phone"></i>聯繫顧客</button>
                        </div>
                    </div>
                </form>
            }
        </form>

        <div class="modal fade" id="contactModal" tabindex="-1" role="dialog" aria-labelledby="contactModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">

                        <h4 class="modal-title" id="contactModalLabel">@Model.Orderset.Uname</h4>
                        <button type="button" id="contactButton2" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-4 d-flex justify-content-center align-items-center">
                                @{
                                    string imageData = Model.Orderset_user.Photo != null ? Convert.ToBase64String(Model.Orderset_user.Photo) : null;
                                }
                                @if (string.IsNullOrEmpty(imageData))
                                {
                                    <img src="~/dist/img/user3-128x128.jpg" alt="圖片" class="user-img imagePreview_img" />
                                }
                                else
                                {
                                    <img src="data:image/jpeg;base64,@imageData" alt="圖片" class="user-img imagePreview_img" />
                                }
                            </div>
                            <div class="col-md-8" style="padding-top:10px;">
                                <div class="form-group alert alert-light alert-form-div" role="alert">
                                    <table>
                                        <tr>
                                            <th><i class="fas fa-phone icon-width"></i></th>
                                            <td type="phone">@Model.Orderset_user.Phone</td>
                                        </tr>
                                        <tr>
                                            <th><i class="fas fa-envelope icon-width"></i></th>
                                            <td type="email">@Model.Orderset_user.Email</td>
                                        </tr>
                                        <tr>
                                            <th><i class="fab fa-line icon-width"></i></th>
                                            <td>@Model.Orderset_user.Line</td>
                                        </tr>
                                        <tr>
                                            <th><label>備註:</label></th>
                                            <td class="wrap-text">@Model.Orderset_user.Remark</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                </div>
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // 獲取按鈕元素
                var contactButton = document.querySelector("#contactButton");
                var contactButton2 = document.querySelector("#contactButton2");
                // 綁定按鈕的點擊事件
                contactButton.addEventListener("click", function () {
                    // 彈出 Modal 窗口
                    $('#contactModal').modal('show');
                });

                contactButton2.addEventListener("click", function () {
                    // 彈出 Modal 窗口
                    $('#contactModal').modal('hide');
                });
            });
        </script>

    </div>
    
</body>
</html>
