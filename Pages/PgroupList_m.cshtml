@page
@model Web0524.Pages.PgroupList_mModel
@using Web0524.Models
@{
    var myService = (IMyService)ViewContext.HttpContext.RequestServices.GetService(typeof(IMyService));
    var myData = myService.GetBaseData();
}
@if (TempData.ContainsKey("edit_success"))
{
    <script>
        setTimeout(function () {
            alert('類別更新完成。');
        @(TempData.Remove("edit_success"));
        }, 100);
    </script>
}
@if (TempData.ContainsKey("del_success"))
{
    <script>
        setTimeout(function () {
            alert('類別已刪除。');
        @(TempData.Remove("del_success"));
        }, 100);
    </script>
}
@if (TempData.ContainsKey("add_success"))
{
    <script>
        setTimeout(function () {
            alert('類別已新增。');
        @(TempData.Remove("add_success"));
        }, 100);
    </script>
}

<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="~/css/Share.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .nav-tabs {
            display: flex;
            margin-bottom: 20px; /* Optional spacing */
        }

        .nav-item {
            margin-right: 20px; /* Adds space between tab buttons */
        }

        .table-borderless th {
            width: 15ch;
        }

        .table-borderless td {
            width: 20ch;
        }
    </style>
    <script>
        function promptPassword() {
            var password = prompt("請輸入您的密碼：");
            if (password === "@Model.User_me.Password" && "@Model.User_me.Password" !== null) {
                // 密碼正確，執行後續處理
                return true;
            } else {
                // 密碼錯誤，提示錯誤訊息或執行其他操作
                alert("密碼錯誤，請重新輸入。");
                return false;
            }
        }
    </script>
    <script>
        function searchCards() {
            var keyword = document.getElementById("keywordInput").value.toLowerCase();
            var cardItems = document.querySelectorAll(".card-item");

            for (var i = 0; i < cardItems.length; i++) {
                var cardName = cardItems[i].getAttribute("data-search");
                var cardSearchContent = cardItems[i].querySelector(".search-content").innerText.toLowerCase();
                if (cardName.includes(keyword) || cardSearchContent.includes(keyword)) {
                    cardItems[i].style.display = "";
                } else {
                    cardItems[i].style.display = "none";
                }
            }
        }
    </script>

</head>
<body>
    <div class="container page-basetop">
        <header>
            <div class="animation-div">
                <h2 class="header_text heading break-all slideInRight">
                    @myData.Name 類別管理
                </h2>
            </div>
            <nav class="nav">
                <input id="keywordInput" class="nav-link" style="margin-right: 10px;" type="text" placeholder="輸入關鍵字">
                <button id="searchButton" class="nav-link fx-tobig" style="margin-right: 10px;" onclick="searchCards()">搜索</button>
            </nav>
            <br>
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button style="margin-right: 10px;color: var(--color3);" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" role="tab" aria-controls="profile-tab-pane" aria-selected="false" id="PgroupTab" class="nav-link fx-tobig" data-tab="Pgroup">類別清單</button>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link fx-tobig" style="margin-right: 10px;color: var(--color3);" asp-page="PgroupAdd">
                        <i class="fas fa-hashtag"></i>
                        新增類別
                    </a>
                </li>
            </ul>
        </header>
        <br>
        <div class="row" id="cardContainer">
            @foreach (var item in Model.Pgroups)
            {
                <div class="col-md-12 mb-4 card-item" data-search="@item.Pgname?.ToLower()">
                    <div class="card" data-cardname="@item.Pgname?.ToLower()">
                        <div class="card-header" data-toggle="collapse" data-target="#collapse-@item.Pgid">
                            <h5 class="card-title">
                                <i class="fas fa-hashtag" style="color:var(--color3)"></i> @item.Pgname
                            </h5>
                        </div>

                        <div id="collapse-@item.Pgid" class="collapse">
                            <div class="card-body">


                                <div class="form-group alert alert-light alert-form-div" role="alert">
                                    <table>
                                        <tr>
                                            <th><i class="fas fa-comment-dots icon-width"></i>描述:</th>
                                            <td>@(string.IsNullOrEmpty(item.Pgcontent) ? '-' : item.Pgcontent)</td>
                                        </tr>
                                        <tr>
                                            <th><i class="fas fa-sort-alpha-down icon-width"></i>排序:</th>
                                            <td>@(string.IsNullOrEmpty(item.Pgorder) ? '-' : item.Pgorder)</td>
                                        </tr>
                                    </table>
                                </div>

                                <div class="form-group alert alert-light alert-form-div" role="alert">
                                    <table>
                                        <tr>
                                            <th><i class="fas fa-tags" style="color:var(--color3_2)"></i> 項目:</th>
                                            @if (Model.Products.Any(p => p.Pgid == @item.Pgid))
                                            {
                                                <td>
                                                    @foreach (var product in Model.Products.Where(p => p.Pgid == @item.Pgid))
                                                    {
                                                        <!-- 在这里显示满足条件的产品信息 -->
                                                        <p>@product.Name</p>
                                                    }
                                                </td>
                                            }
                                            else
                                            {
                                                <td>-</td>
                                            }
                                        </tr>

                                    </table>
                                </div>



                            </div>

                            <div class="card-footer  d-flex justify-content-between" style="height: 60px;">
                                <div>
                                    <a class="btn btn-primary" asp-page="PgroupEdit" asp-route-id="@item.Pgid">
                                        <i class="fas fa-cog"></i> 編輯
                                    </a>
                                </div>
                                <form id="deluser" method="post" onsubmit="return promptPassword()" class="ml-auto">
                                    <input type="hidden" name="PgId" value="@item.Pgid" />
                                    <button type="submit" class="btn btn-danger"><i class="fas fa-trash-alt"></i> 刪除</button>
                                </form>
                            </div>
                            <div class="search-content" style="display:none;">
                                    <span>@item.Pgcontent?.ToLower()</span>
                                    <span>@item.Pgname?.ToLower()</span>
                                    @foreach (var product in Model.Products.Where(p => p.Pgid == @item.Pgid))
                                    {
                                    <span>@product.Name?.ToLower()</span>
                                    }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</body>
</html>







