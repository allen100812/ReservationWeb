@page
@model Web0524.Pages.OrderEditModel
@using Web0524.Models
@{
}
@{
    var myService = (IMyService)ViewContext.HttpContext.RequestServices.GetService(typeof(IMyService));
    var myData = myService.GetBaseData();
}
<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="~/css/Share.css">
    <link rel="stylesheet" href="~/css/wickedcss.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        function confirmAndSubmit(type) {
            var confirmed = false;
            if (type === 0) {
                confirmed = confirm('確認取消本次預約？※提醒您，經常取消預約會降低您的信用評價。');
            }
            if (type === 1) {
                confirmed = confirm('本次預約已被商家接受，請確認是否提出取消本次預約？(確認後系統將會同步通知商家，用戶已取消本次預約)，※提醒您，經常取消預約會降低您的信用評價。');
            }
            if (confirmed) {
                document.querySelector('form').submit(); // 提交表單，將日期傳遞到後端
            } else {
                // 取消確認，不進行任何動作
            }
        }

    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        function showContactModal() {
            $('#contactModal').modal('show');
        }
    </script>
<style>
        .order-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            margin-bottom: 10px;
        }

        .order-img img {
            max-height: 500px;
            width: 100%; /* 设置图像最大宽度 */
            height: auto; /* 保持图像高度自动适应 */
            object-fit: cover; /* 保持比例，显示完整图片 */
            border-radius: 10px;
            margin-right: 30px; /* 调整图像和文本之间的间距 */
        }

        .order-details {
            flex: 1; /* 文本部分占据剩余宽度 */
        }

        .order-details-title {
            font-weight: bold;
            font-size: 22px;
            color: var(--color3);
            line-height: 26px; /* 使用像素设置行高 */
        }
        .order-details-text {
            font-weight: normal;
            font-size: 18px;
            color: var(--color3_2);
            line-height: 18px; /* 使用像素设置行高 */
        }

        .div-button {
            justify-content: flex-end; /* 或者使用 flex-start 或 center */
            align-items: flex-end; /* 控制水平对齐方式 */
        }

        .modal-text{
            color: var(--color3);
        }
        .modal-title{
            color: var(--color3);
        }
</style>
</head>
<body>
    <div class="container page-basetop">
        <form method="post">
            <div class="form-group" style="display: none;">
                <input asp-for="Orderset.Pid" class="form-control" readonly />
                <span class="text-danger"></span>
            </div>
            <div class="form-group" style="display: none;">
                <input asp-for="Orderset.Pname" class="form-control" readonly />
                <span class="text-danger"></span>
            </div>
            <div class="form-group" style="display: none;">
                <input asp-for="Orderset.Price" class="form-control" readonly />
                <span class="text-danger"></span>
            </div>
            <div class="form-group" style="display: none;">
                <label>產品單位</label>
                <input asp-for="Orderset.Unit" class="form-control" readonly />
                <span class="text-danger"></span>
            </div>
            <div class="form-group" style="display: none;">
                <label asp-for="Orderset.Event"></label>
                <input asp-for="Orderset.Event" class="form-control" readonly />
            </div>
            <div class="form-group" style="display: none;">
                <label asp-for="Orderset.Uid"></label>
                <input asp-for="Orderset.Uid" class="form-control" readonly />
            </div>
            <div class="form-group" style="display: none;">
                <label asp-for="Orderset.Uname"></label>
                <input asp-for="Orderset.Uname" class="form-control" readonly />
            </div>

            <div class="card animate__animated animate__fadeInUpBig">
                <div class="card-body">
                    <div class="container">
                        <div class="row ">

                            <div class="col-md-6 order-img">
                                @{
                                    string imageData = Model.Orderset.Photo != null ? Convert.ToBase64String(Model.Orderset.Photo) : null;
                                }
                                @if (string.IsNullOrEmpty(imageData))
                                {
                                    <img src="dist/img/product.jpg" alt="圖片">
                                }
                                else
                                {
                                    <img src="data:image/jpeg;base64,@imageData" alt="圖片">
                                }
                            </div>
                            <div class="col-md-6">
                                <div class="col-container d-flex flex-column justify-content-between" style="height:100%;">
                                    <div class="align-top">
                                        <h5 class="order-details-title">@Model.Orderset.Pname</h5>
                                        <p class="order-details-title">
                                            @{
                                                switch (Model.Orderset.Event)
                                                {
                                                    case "0":
                                                        <i class="fas fa-clock text-info"></i>
                                                        <td><span class="text-info">正在等待接受</span></td>
                                                        break;
                                                    case "1":
                                                        <i class="fas fa-check-circle text-success"></i>
                                                        <td><span class="text-success">預約成功</span></td>
                                                        break;
                                                    case "9":
                                                        <i class="fas fa-times-circle text-danger"></i>
                                                        <td><span class="text-danger">預約已取消</span></td>
                                                        break;
                                                    case "10":
                                                        <i class="fas fa-hourglass text-warning"></i>
                                                        <td><span class="text-warning">未被接受</span></td>
                                                        break;
                                                    case "11":
                                                        <i class="fas fa-check text-primary"></i>
                                                        <td><span class="text-primary">已完成</span></td>
                                                        break;
                                                    case "19":
                                                        <i class="fas fa-ban text-secondary"></i>
                                                        <td><span class="text-secondary">已取消</span></td>
                                                        break;
                                                    default:
                                                        <i class="fas fa-question-circle text-muted"></i>
                                                        <td><span class="text-muted">不明</span></td>
                                                        break;
                                                }
                                            }
                                        </p>
                                        <div class="table-responsive">
                                            <table class="table">
                                                <tbody>
                                                    @{
                                                        DateTime date = Convert.ToDateTime(Model.Orderset.Date + Model.Orderset.Time);
                                                        DateTime Orderdate = Convert.ToDateTime(Model.Orderset.Orderdate);
                                                        string price = Model.Orderset.Price != null ? Model.Orderset.Price.ToString() : "無";
                                                        string unit = Model.Orderset.Unit != null ? "/" + Model.Orderset.Unit.ToString() : "";
                                                    }

                                                    <tr>
                                                        <th style="width:25%"><span class="order-details-text">預定編號:</span></th>
                                                        <td style="width:75%"><span class="order-details-text">@("S" + Model.Orderset.Sid.ToString().PadLeft(6, '0'))</span></td>
                                                    <tr>
                                                        <th style="width:25%"><span class="order-details-text">預約門市:</span></th>
                                                        <td style="width:75%"><span class="order-details-text"> <i class="fas fa-map-marker-alt icon-width"></i>@Model.place.Placetitle-@Model.place.Placeaddress</span></td>
                                                    </tr>
                                                    <tr>
                                                        <th style="width:25%"><span class="order-details-text">預約時間:</span></th>
                                                        <td style="width:75%"><span class="order-details-text">@date.ToShortDateString() <i class="fas fa-clock icon-width"></i>@date.ToShortTimeString()</span></td>
                                                    </tr>
@*                                                    <tr >
                                                        <th style="width:25%"><span class="order-details-text">消費方式:</span></th>
                                                        <td style="width:75%"><span class="order-details-text"><i class="fas fa-dollar-sign icon-width"></i>@price@unit</span></td>
                                                    </tr>*@
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="align-bottom">
                                            @if (Model.Orderset.Event == "0")
                                            {
                                                <form method="post">
                                                    <input type="hidden" name="OrigEvent" id="OrigEventInput" value="@Model.Orderset.Event" />
                                                    <input type="hidden" name="SetEvent" id="eventInput" value="9" />
                                                    <input type="hidden" name="sid" value="@Model.Orderset.Sid" />
                                                <button type="button" class="btn btn-danger btn-block" onclick="confirmAndSubmit(0)"><i class="fas fa-times icon-width"></i>取消預約</button>
                                                <button id="contactButton" onclick="showContactModal()" type="button" class="btn btn-primary btn-block"><i class="fas fa-phone icon-width"></i>聯繫客服</button>
                                                </form>
                                            }
                                            else if (Model.Orderset.Event == "1")
                                            {
                                                <form method="post">
                                                    <input type="hidden" name="OrigEvent" id="OrigEventInput" value="@Model.Orderset.Event" />
                                                    <input type="hidden" name="SetEvent" id="eventInput" value="9" />
                                                    <input type="hidden" name="sid" value="@Model.Orderset.Sid" />
                                                <button type="button" class="btn btn-danger btn-block" onclick="confirmAndSubmit(1)"><i class="fas fa-times icon-width"></i>取消已被接受的預約</button>
                                                <button id="contactButton" onclick="showContactModal()" type="button" class="btn btn-primary btn-block"><i class="fas fa-phone icon-width"></i>聯繫客服</button>
                                                </form>

                                            }
                                            else if (Model.Orderset.Event == "9")
                                            {
                                            <button id="orderButton" type="submit" formaction="/ProductList" formmethod="get" class="btn btn-success btn-block"><i class="fas fa-redo icon-width"></i>重新預約</button>
                                            <button id="contactButton" onclick="showContactModal()" type="button" class="btn btn-primary btn-block"><i class="fas fa-phone icon-width"></i>聯繫客服</button>
                                            }
                                            else if (Model.Orderset.Event == "10" || Model.Orderset.Event == "19")
                                            {

                                            <button id="orderButton" type="submit" formaction="/ProductList" formmethod="get" class="btn btn-success btn-block"><i class="fas fa-redo icon-width"></i>重新預約</button>
                                            <button id="contactButton" onclick="showContactModal()" type="button" class="btn btn-primary btn-block"><i class="fas fa-phone icon-width"></i>聯繫客服</button>
                                            }
                                            else if (Model.Orderset.Event == "11")
                                            {

                                            <button id="orderButton" type="submit" formaction="/ProductList" formmethod="get" class="btn btn-success btn-block"><i class="fas fa-redo icon-width"></i>再次預約</button>
                                            <button id="contactButton" onclick="showContactModal()" type="button" class="btn btn-primary btn-block"><i class="fas fa-phone icon-width"></i>聯繫客服</button>
                                            }
                                    </div>
                                </div>
                            </div>
  
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div class="modal fade" id="contactModal" tabindex="-1" role="dialog" aria-labelledby="contactModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <img src="dist/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8; width: 32px; height: 32px; object-fit: cover; object-position: center;margin-right: 10px;">
                    <h4 class="modal-title" id="contactModalLabel">@myData.Name</h4>

                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4 d-flex justify-content-center align-items-center">
                            <a href="@myData.Line_Url" target="_blank">
                                <img src="\dist\img\Lineqrcode.png" alt="Line QR Code" width="150">
                            </a>
                        </div>
                        <div class="col-md-8" style="padding-top:10px;">
                            <!-- 這裡顯示 Orderset.Phone -->
                            <div type="phone"><h5 class="modal-text"><i class="fas fa-phone"></i> @myData.Phone</h5></div>

                            <!-- 這裡顯示 Orderset.Email -->
                            <div type="text"><h5 class="modal-text"><i class="fab fa-line"></i> @myData.Line_Url</h5></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>


</html>