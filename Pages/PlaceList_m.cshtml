@page
@model Web0524.Pages.PlaceList_mModel
@using Web0524.Models
@{
    var myService = (IMyService)ViewContext.HttpContext.RequestServices.GetService(typeof(IMyService));
    var myData = myService.GetBaseData();
}
@if (TempData.ContainsKey("edit_success"))
{
    <script>
        setTimeout(function () {
            alert('店鋪更新完成。');
        @(TempData.Remove("edit_success"));
        }, 100);
    </script>
}
@if (TempData.ContainsKey("del_success"))
{
    <script>
        setTimeout(function () {
            alert('店鋪已刪除。');
        @(TempData.Remove("del_success"));
        }, 100);
    </script>
}
@if (TempData.ContainsKey("add_success"))
{
    <script>
        setTimeout(function () {
            alert('店鋪已新增。');
        @(TempData.Remove("add_success"));
        }, 100);
    </script>
}

<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="~/css/Share.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>美容工作室介紹</title>
    <style>
        .nav-tabs {
            display: flex;
            margin-bottom: 20px; /* Optional spacing */
        }

        .nav-item {
            margin-right: 20px; /* Adds space between tab buttons */
        }

        .table-borderless th {
            width: 15ch;
        }

        .table-borderless td {
            width: 20ch;
        }
    </style>
    <script>
        function promptPassword() {
            var password = prompt("請輸入您的密碼：");
            if (password === "@Model.User_me.Password" && "@Model.User_me.Password" !== null) {
                // 密碼正確，執行後續處理
                return true;
            } else {
                // 密碼錯誤，提示錯誤訊息或執行其他操作
                alert("密碼錯誤，請重新輸入。");
                return false;
            }
        }
    </script>
    <script>
        function searchCards() {
            var keyword = document.getElementById("keywordInput").value.toLowerCase();
            var cardItems = document.querySelectorAll(".card-item");

            for (var i = 0; i < cardItems.length; i++) {
                var cardName = cardItems[i].getAttribute("data-search");
                var cardSearchContent = cardItems[i].querySelector(".search-content").innerText.toLowerCase();
                if (cardName.includes(keyword) || cardSearchContent.includes(keyword)) {
                    cardItems[i].style.display = "";
                } else {
                    cardItems[i].style.display = "none";
                }
            }
        }
    </script>

</head>
<body>
    <div class="container page-basetop">
        <header>
            <div class="animation-div">
                <h2 class="header_text heading break-all slideInRight">
                    @myData.Name 店鋪管理
                </h2>
            </div>
            <nav class="nav">
                <input id="keywordInput" class="nav-link" style="margin-right: 10px;" type="text" placeholder="輸入關鍵字">
                <button id="searchButton" class="nav-link fx-tobig" style="margin-right: 10px;" onclick="searchCards()">搜索</button>
            </nav>
            <br>
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button style="margin-right: 10px;color: var(--color3);" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" role="tab" aria-controls="profile-tab-pane" aria-selected="false" id="PlaceTab" class="nav-link fx-tobig" data-tab="Place">店鋪清單</button>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link fx-tobig" style="margin-right: 10px;color: var(--color3);" asp-page="PlaceAdd">
                        <i class="fas fa-store"></i>
                        新增店鋪
                    </a>
                </li>
            </ul>
        </header>
        <br>
        <div class="row" id="cardContainer">
            @foreach (var item in Model.Places)
            {
                <div class="col-md-12 mb-4 card-item" data-search="@item.Placetitle?.ToLower() @item.Placeaddress?.ToLower()">
                    <div class="card" data-cardname="@item.Placetitle?.ToLower()">
                        <div class="card-header" data-toggle="collapse" data-target="#collapse-@item.Placeid">
                            <h5 class="card-title">
                                <i class="fas fa-store" style="color:var(--color3)"></i> @item.Placetitle
                            </h5>
                        </div>

                        <div id="collapse-@item.Placeid" class="collapse">
                            <div class="card-body">
                                <div class="form-group alert alert-light alert-form-div" role="alert">
                                    <table style="width:100%;">
                                        <tr>
                                            <th>
                                                <label><i class="fas fa-map-marker-alt icon-width"></i>地址:</label>
                                            </th>
                                            <td>
                                                <label>@(string.IsNullOrEmpty(item.Placeaddress) ? '-' : item.Placeaddress)</label>
                                            </td>
                                        </tr>
                                        <tr>
                                            @if (item.PlaceSw == 1)
                                            {
                                                <th>
                                                    <label><i class="fas fa-shopping-cart icon-width"></i>狀態:</label>
                                                </th>
                                                <td>
                                                    <label class="text-success">開放預約</label>
                                                </td>

                                            }
                                            else
                                            {
                                                <th>
                                                    <label><i class="fas fa-shopping-cart icon-width"></i>狀態:</label>
                                                </th>
                                                <td>
                                                    <label class="text-danger">暫停預約</label>
                                                </td>
                                            }
                                        </tr>
                                        <tr>
                                            <th>
                                                <label><i class="fas fa-sort-alpha-down icon-width"></i>排序:</label>
                                            </th>
                                            <td>
                                                <label>@(string.IsNullOrEmpty(item.Placeorder) ? '-' : item.Placeorder)</label>
                                            </td>
                                        </tr>
                                    </table>
                                </div>

                                <div class="form-group alert alert-light alert-form-div" role="alert">
                                    <table style="width:100%;">
                                        <tr>
                                            <th>
                                                <label><i class="fas fa-tags icon-width" style="color:var(--color3_2)"></i>項目:</label>
                                            </th>
                                            @{
                                                var pidArray = item.Placepid?.Split(',');
                                            }
                                            @if (pidArray.Length != 0)
                                            {
                                                <td>
                                                    @foreach (var pid in pidArray)
                                                    {
                                                        var product = @Model.Products.FirstOrDefault(p => p.Pid == pid);
                                                        if (product != null)
                                                        {
                                                            @product.Name
                                                            if (pid != pidArray.Last())
                                                            { // 检查是否为最后一个项目
                                                                @(", ")
                                                                // 添加逗号分隔符
                                                            }
                                                        }
                                                    }
                                                </td>
                                            }
                                            else
                                            {
                                                <td>-</td>
                                            }
                                        </tr>
                                    </table>
                                </div>
                            </div>

                            <div class="card-footer  d-flex justify-content-between" style="height: 60px;">
                                <div>
                                    <a class="btn btn-primary" asp-page="PlaceEdit" asp-route-id="@item.Placeid">
                                        <i class="fas fa-cog icon-width"></i>編輯
                                    </a>
                                </div>
                                <form id="deluser" method="post" onsubmit="return promptPassword()" class="ml-auto">
                                    <input type="hidden" name="placeId" value="@item.Placeid" />
                                    <button type="submit" class="btn btn-danger"><i class="fas fa-trash-alt icon-width"></i>刪除</button>
                                </form>
                            </div>
                            <div class="search-content" style="display:none;">
                                @foreach (var pid in pidArray)
                                {
                                    var product = @Model.Products.FirstOrDefault(p => p.Pid == pid);
                                    if (product != null)
                                    {
                                        <span>@product.Name?.ToLower()</span>
                                    }
                                }
                                @if (item.PlaceSw == 1)
                                {
                                    <span>開放預約</span>

                                }
                                else
                                {
                                    <span>暫停預約</span>
                                }

                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</body>
</html>






           
